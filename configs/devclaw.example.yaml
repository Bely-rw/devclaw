# ─────────────────────────────────────────────────────────────
# DevClaw - Configuration
# Copy to config.yaml and adjust as needed:
#   cp configs/devclaw.example.yaml config.yaml
# ─────────────────────────────────────────────────────────────

# ── Assistant ──────────────────────────────────────────────
name: "DevClaw"
trigger: "@devclaw"                    # Keyword that activates the bot
model: "gpt-5-mini"                    # LLM model (see options below)
timezone: "America/Sao_Paulo"
language: "pt-BR"
instructions: |
  You are a helpful personal assistant.
  Be concise and practical in your responses.
  Respond in Portuguese when the user writes in Portuguese.

# ── API Provider ──────────────────────────────────────────
# OpenAI-compatible endpoint. Supports OpenAI, Anthropic, GLM, etc.
api:
  base_url: "https://api.openai.com/v1"        # OpenAI (default)
  api_key: "${DEVCLAW_API_KEY}"                  # NEVER hardcode — use .env file
  provider: ""                                  # Auto-detected from URL
  #
  # Available models:
  #
  # GLM (api.z.ai):
  #   glm-4.7-flash    — fast, low cost (default)
  #   glm-4.7-flashx   — fast with extended context
  #   glm-4.7          — balanced capability
  #   glm-5            — most capable GLM
  #
  # OpenAI:
  #   gpt-5            — latest flagship
  #   gpt-5-mini       — fast and cost-effective
  #   gpt-4o           — great all-around
  #   gpt-4o-mini      — fast and cheap
  #   gpt-4.5-preview  — enhanced reasoning
  #
  # Anthropic:
  #   claude-opus-4.6  — most capable
  #   claude-opus-4.5  — previous flagship
  #   claude-sonnet-4.5 — balanced performance

# ── Access Control ─────────────────────────────────────────
# Who can use the bot. Default: deny (only authorized contacts).
access:
  default_policy: deny                 # deny | allow | ask
  owners:                              # Full control (your phone number)
    - "5511999999999"
  admins: []                           # Can manage users + workspaces
  allowed_users: []                    # Can interact with the bot
  blocked_users: []                    # Explicitly blocked
  allowed_groups: []                   # Group JIDs allowed
  blocked_groups: []                   # Group JIDs blocked
  pending_message: "Access not authorized. Contact an admin."

# ── Intent Router ──────────────────────────────────────────
# Advanced message routing and filtering.
intent_router:
  enabled: true                        # Master switch for the router
  magic_word: "sudo_make_me_sandwich"  # Bypass word: skips all filters if present

  # Layer 1: Regex Filter
  # Quick pattern matching for dropping spam or routing to fast tasks.
  regex:
    enabled: true
    block_patterns:                    # Regexes to silently drop
      - "^ignore_me.*"
      - "^spam_.*"
    fast_task_patterns:                # Regex -> Intent (routes to unique session)
      "^/ping": "fast_task:ping"
      "^/weather": "fast_task:weather"

  # Layer 2: Embedding Router
  # Routes based on semantic meaning of the message.
  embedding:
    enabled: true
    min_score: 0.75                    # 0.0-1.0 similarity threshold
    routes:                            # Intent Label -> Session Suffix (Role)
      "coding_question": ":coder"      # Routes to 'coder' agent
      "casual_chat": ""                # Default session
      "infrastructure": ":ops"         # Routes to 'ops' agent

  # Layer 3: Semantic Scoring
  # Uses LLM to score message value/importance (0-10).
  scoring:
    enabled: true
    min_score: 3.0                     # Drop messages below this score
    model: "qwen2.5:0.5b"              # Lightweight model for scoring

# ── Workspaces ─────────────────────────────────────────────
# Isolated profiles: each has its own prompt, skills, model, memory.
workspaces:
  default_workspace: "default"
  workspaces:
    - id: "default"
      name: "Default"
      description: "Default workspace for all users"
      active: true

    # Uncomment and customize:
    #
    # - id: "personal"
    #   name: "Personal"
    #   instructions: |
    #     You are my personal assistant. Help with daily tasks.
    #   model: "gpt-4o"
    #   language: "pt-BR"
    #   skills: [weather, web-search, gog]
    #   members: ["5511999999999"]
    #
    # - id: "work"
    #   name: "Work Team"
    #   instructions: |
    #     You are a technical assistant for our dev team.
    #   skills: [github, web-search, summarize]
    #   members: ["5511888888888"]
    #   groups: ["120363000000000000@g.us"]

# ── Channels ───────────────────────────────────────────────
channels:
  whatsapp:
    session_dir: "./sessions/whatsapp"
    trigger: "@devclaw"
    respond_to_groups: true
    respond_to_dms: true
    auto_read: true
    send_typing: true
    media_dir: "./data/media"
    max_media_size_mb: 16

# ── Browser Automation ─────────────────────────────────────
# Native browser tools (Chrome/Chromium via CDP).
browser:
  enabled: true                        # Enable browser tools
  chrome_path: "/usr/bin/google-chrome" # Path to Chrome binary (Linux/WSL)
  headless: true                       # Run without a window (recommended for WSL/Docker)
  timeout_seconds: 60                  # Max time for page operations
  max_pages: 3                         # Max concurrent pages
  viewport_width: 1280
  viewport_height: 720

# ── Memory ─────────────────────────────────────────────────
memory:
  type: "sqlite"
  path: "./data/memory.db"
  max_messages: 100
  compression_strategy: "summarize"

# ── Security ───────────────────────────────────────────────
security:
  max_input_length: 4096
  rate_limit: 30
  enable_pii_detection: false
  enable_url_validation: true

# ── Token Budget ───────────────────────────────────────────
token_budget:
  total: 128000
  reserved: 4096
  system: 500
  skills: 2000
  memory: 1000
  history: 8000
  tools: 4000

# ── Plugins ────────────────────────────────────────────────
plugins:
  dir: "./plugins"

# ── Skills ─────────────────────────────────────────────────
skills:
  builtin: [weather, calculator, web-search, web-fetch]
  installed: [github, gog, summarize]

# ── MCP Clients ────────────────────────────────────────────
# External Model Context Protocol (MCP) servers.
# Connects to external tools (like NotebookLM, Memory, etc.) via subprocesses.
mcp_clients:
  - name: "memory"                    # Tool prefix (e.g. memory_call)
    command: "npx"                    # Executable to launch
    args: ["-y", "@modelcontextprotocol/server-memory"] # Arguments
    env: ["NODE_ENV=production"]      # Extra environment variables
    timeout_seconds: 30               # Per-call timeout
    disabled: true                    # Set to false to enable

# ── Scheduler ──────────────────────────────────────────────
scheduler:
  enabled: true
  storage: "./data/scheduler.db"

# ── Logging ────────────────────────────────────────────────
logging:
  level: "info"                        # debug | info | warn | error
  format: "json"                       # json | text
